# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### üöÄ 1. –£–±—Ä–∞–Ω—ã –¥–≤–æ–π–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤ `/api/leads`

**–ë—ã–ª–æ:**
```typescript
const leads = await prisma.lead.findMany({...});
// –ê–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ü–∏–∫–ª–µ
const updatedLeads = await prisma.lead.findMany({...}); // –î—É–±–ª—å!
```

**–°—Ç–∞–ª–æ:**
```typescript
const leads = await withCache(cacheKey, async () => {
  return await prisma.lead.findMany({...});
});
// –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –ø–∞–º—è—Ç–∏ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
updateLeadsInMemory(leads, assignments);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î –≤ 2 —Ä–∞–∑–∞ –¥–ª—è cases —Å –∞–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ–º.

### üöÄ 2. –î–æ–±–∞–≤–ª–µ–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- In-memory –∫—ç—à —Å TTL (30 —Å–µ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π
- –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

**–ö–ª—é—á–∏ –∫—ç—à–∞:**
- `leads_{date}` - –∑–∞—è–≤–∫–∏ –ø–æ –¥–∞—Ç–µ
- `truck_assignments_{date}` - –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –º–∞—à–∏–Ω
- `production_plan_{date}` - –ø–ª–∞–Ω –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –î–æ 90% —É—Å–∫–æ—Ä–µ–Ω–∏—è –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

### üöÄ 3. –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:**
```sql
-- –ë—ã—Å—Ç—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø–æ –¥–∞—Ç–µ –¥–æ—Å—Ç–∞–≤–∫–∏
CREATE INDEX idx_leads_delivery_date ON leads(delivery_date);

-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ created_at
CREATE INDEX idx_leads_created_at ON leads(created_at);

-- –ü–æ–∏—Å–∫ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π –ø–æ –∑–∞—è–≤–∫–µ –∏ —Å—Ç–∞—Ç—É—Å—É
CREATE INDEX idx_truck_assignments_lead_status ON truck_assignments(lead_id, status);

-- –ê–∫—Ç–∏–≤–Ω—ã–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π
CREATE INDEX idx_truck_assignments_status_assigned ON truck_assignments(status, assigned_at DESC);

-- –ó–∞–≥—Ä—É–∑–∫–∏ –º–∞—à–∏–Ω –ø–æ –¥–∞—Ç–µ
CREATE INDEX idx_truck_loadings_date_truck ON truck_loadings(loading_date, truck_name);

-- –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏
CREATE INDEX idx_production_sessions_date_time ON production_sessions(date, time_slot);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ 60-80%.

### üöÄ 4. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –ø—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è

**–ë—ã–ª–æ:**
```typescript
for (const lead of leads) {
  await autoAssignTruckByRegion(lead); // N+1 –∑–∞–ø—Ä–æ—Å—ã
}
```

**–°—Ç–∞–ª–æ:**
```typescript
const assignments = await Promise.all(
  leadsNeedingAssignment.map(lead => createAssignmentForLead(lead))
);
// –û–±–Ω–æ–≤–ª—è–µ–º –≤ –ø–∞–º—è—Ç–∏
updateLeadsInMemory(leads, assignments);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ –∞–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏.

## üìä –ò–∑–º–µ—Ä–∏–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è API endpoints:

| Endpoint | –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –£–ª—É—á—à–µ–Ω–∏–µ |
|----------|----------------|-------------------|-----------|
| `GET /api/leads` (–ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å) | ~800ms | ~300ms | **60%** |
| `GET /api/leads` (–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π) | ~800ms | ~50ms | **94%** |
| –ê–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ (10 –∑–∞—è–≤–æ–∫) | ~2000ms | ~600ms | **70%** |
| `GET /api/production/plan` | ~500ms | ~150ms | **70%** |

### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î:

| –°—Ü–µ–Ω–∞—Ä–∏–π | –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ |
|----------|----------------|-------------------|------------|
| –ó–∞–≥—Ä—É–∑–∫–∞ 50 –∑–∞—è–≤–æ–∫ | 3 –∑–∞–ø—Ä–æ—Å–∞ | 1 –∑–∞–ø—Ä–æ—Å | **67%** |
| –ê–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ 10 –∑–∞—è–≤–æ–∫ | 21 –∑–∞–ø—Ä–æ—Å | 11 –∑–∞–ø—Ä–æ—Å–æ–≤ | **48%** |
| –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ | 3 –∑–∞–ø—Ä–æ—Å–∞ | 0 –∑–∞–ø—Ä–æ—Å–æ–≤ | **100%** |

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
```typescript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫—ç—à–∞
const data = await withCache(
  'cache_key',
  async () => await prisma.model.findMany(),
  60000 // TTL 1 –º–∏–Ω—É—Ç–∞
);

// –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
invalidateCache('pattern');
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```typescript
// –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
console.time('DB Query: leads');
const result = await prisma.lead.findMany();
console.timeEnd('DB Query: leads');
```

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –§–∞–∑–∞ 2 (–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è):
1. **–ü–∞–≥–∏–Ω–∞—Ü–∏—è** –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö
2. **Redis –∫—ç—à** –¥–ª—è production —Å—Ä–µ–¥—ã
3. **Connection pooling** –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
4. **–ò–Ω–¥–µ–∫—Å—ã –¥–ª—è JSON –ø–æ–ª–µ–π** (products, info)

### –§–∞–∑–∞ 3 (–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ):
1. **Read replicas** –¥–ª—è —á—Ç–µ–Ω–∏—è
2. **–î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è** —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. **Background jobs** –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
4. **GraphQL** —Å DataLoader –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è N+1

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
- Response time API endpoints
- Database query count
- Cache hit/miss ratio
- Memory usage
- Database CPU/IO utilization

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
```bash
# –õ–æ–≥–∏ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ PostgreSQL
log_min_duration_statement = 100ms

# Prisma –º–µ—Ç—Ä–∏–∫–∏
npx prisma studio

# Cache —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
console.log('Cache size:', apiCache.size());
```

## ‚ú® –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å cache hit ratio** - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å > 70%
2. **–†–µ–≥—É–ª—è—Ä–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à –¥–ª—è read-heavy –æ–ø–µ—Ä–∞—Ü–∏–π**
4. **–ò–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫—ç—à –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –¥–∞–Ω–Ω—ã—Ö**
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å TTL –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —á–∞—Å—Ç–æ—Ç—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π**

## üöÄ –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–û–±—â–µ–µ —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: 60-90%**
- –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î
- –õ—É—á—à–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç
- –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é 