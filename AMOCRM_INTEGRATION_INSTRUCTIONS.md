# üöÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–∏–¥–∂–µ—Ç–∞ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∞–¥—Ä–µ—Å–æ–≤ —Å AMOCRM

## üìã –û–ø–∏—Å–∞–Ω–∏–µ
–í–∏–¥–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ª—É—á—à–∞–µ—Ç –ø–æ–ª—è –≤–≤–æ–¥–∞ –∞–¥—Ä–µ—Å–æ–≤ –≤ AMOCRM, –¥–æ–±–∞–≤–ª—è—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL.

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ AMOCRM

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
1. –í–æ–π–¥–∏—Ç–µ –≤ AMOCRM –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** ‚Üí **–°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é**

### –®–∞–≥ 2: –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- **–ù–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**: `–ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–æ–≤`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: `–í–∏–¥–∂–µ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∞–¥—Ä–µ—Å–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏`

### –®–∞–≥ 3: URL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)
- **–°—Å—ã–ª–∫–∞ –¥–ª—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: `https://dashboard-hrustal.skybric.com/address-autocomplete.js`
- **–°—Å—ã–ª–∫–∞ –¥–ª—è —Ö—É–∫–∞ –æ–± –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏**: `https://dashboard-hrustal.skybric.com/api/amocrm/webhook`

### –®–∞–≥ 4: –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ **–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø: –í—Å–µ**
- ‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å –¥—É–±–ª–µ–π**
- ‚úÖ **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏**

### –®–∞–≥ 5: –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–¥–∞
- –ù–∞–∂–º–∏—Ç–µ **"–ó–∞–≥—Ä—É–∑–∏—Ç—å"** –≤ —Å–µ–∫—Ü–∏–∏ "–ê—Ä—Ö–∏–≤ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –∫–æ–¥–æ–º"
- –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª `address-autocomplete.js`

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏

### –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª: `address-autocomplete.js`
```javascript
// URL –¥–ª—è —Ö—É–∫–∞ AMOCRM
const CONFIG = {
  API_URL: 'https://dashboard-hrustal.skybric.com/api/addresses/search',
  REDIRECT_URL: 'https://dashboard-hrustal.skybric.com/address-autocomplete.js',
  WEBHOOK_URL: 'https://dashboard-hrustal.skybric.com/api/amocrm/webhook',
  // ...
};
```

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ AMOCRM

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –ø–æ–ª–µ–π
–í–∏–¥–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç –∏ —É–ª—É—á—à–∞–µ—Ç –ø–æ–ª—è —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º:
```html
<input type="text" name="delivery_address" data-address-autocomplete>
```

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
const status = window.AddressAutocomplete.isEnabled();

// –û—Ç–∫–ª—é—á–∏—Ç—å –≤–∏–¥–∂–µ—Ç
window.AddressAutocomplete.disableWidget();

// –í–∫–ª—é—á–∏—Ç—å –≤–∏–¥–∂–µ—Ç
window.AddressAutocomplete.enableWidget();

// –ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ö—É–∫–∞
const settings = window.AddressAutocomplete.getAmocrmWebhookSettings();
```

## üîç API Endpoint

### –ü–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–æ–≤
```
GET /api/addresses/search?q=–ø–æ–∏—Å–∫–æ–≤—ã–π_–∑–∞–ø—Ä–æ—Å&limit=10
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `q` - –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞)
- `limit` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10)

**–û—Ç–≤–µ—Ç:**
```json
{
  "addresses": [
    "–ú–æ—Å–∫–≤–∞, —É–ª. –¢–≤–µ—Ä—Å–∫–∞—è, 1",
    "–ú–æ—Å–∫–≤–∞, —É–ª. –ê—Ä–±–∞—Ç, 15",
    "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –ù–µ–≤—Å–∫–∏–π –ø—Ä., 28"
  ]
}
```

## üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π
```javascript
// –í —Ñ—É–Ω–∫—Ü–∏–∏ createAutocompleteElement()
input.style.cssText = `
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
  outline: none;
`;
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
```javascript
const CONFIG = {
  DEBOUNCE_DELAY: 300,        // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–æ–∏—Å–∫–∞ (–º—Å)
  MIN_QUERY_LENGTH: 2,        // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∑–∞–ø—Ä–æ—Å–∞
  MAX_SUGGESTIONS: 10         // –ú–∞–∫—Å–∏–º—É–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
};
```

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –í–∏–¥–∂–µ—Ç –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å URL –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö AMOCRM
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–º–µ–Ω –¥–æ–±–∞–≤–ª–µ–Ω –≤ CORS
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

### –ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ —Ç–∞–±–ª–∏—Ü–µ `leads` –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SQL –∑–∞–ø—Ä–æ—Å –≤ API

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞
1. –î–æ–±–∞–≤—å—Ç–µ –∏–Ω–¥–µ–∫—Å—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
2. –£–≤–µ–ª–∏—á—å—Ç–µ `DEBOUNCE_DELAY`
3. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ `MAX_SUGGESTIONS`

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª–∏
```javascript
// –í–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞
‚úÖ –í–∏–¥–∂–µ—Ç –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∞–¥—Ä–µ—Å–æ–≤ –≤–∫–ª—é—á–µ–Ω
‚ùå –í–∏–¥–∂–µ—Ç –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∞–¥—Ä–µ—Å–æ–≤ –æ—Ç–∫–ª—é—á–µ–Ω

// –ü–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–æ–≤
–ü–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–æ–≤: "–º–æ—Å–∫–≤–∞" - –Ω–∞–π–¥–µ–Ω–æ 5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
```

### –°–æ–±—ã—Ç–∏—è
```javascript
// –°–ª—É—à–∞–µ–º –≤—ã–±–æ—Ä –∞–¥—Ä–µ—Å–∞
document.addEventListener('addressSelected', (event) => {
  console.log('–í—ã–±—Ä–∞–Ω –∞–¥—Ä–µ—Å:', event.detail.address);
  console.log('–ü–æ–ª–µ:', event.detail.field);
});
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```javascript
// –í Next.js API route
export async function GET(request: Request) {
  const response = NextResponse.json({ addresses: [] });
  response.headers.set('Access-Control-Allow-Origin', 'https://your-amocrm-domain.com');
  response.headers.set('Access-Control-Allow-Methods', 'GET');
  return response;
}
```

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```javascript
// –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–æ–∫–µ–Ω–∞ –≤ API
const authHeader = request.headers.get('authorization');
if (!authHeader || !validateToken(authHeader)) {
  return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
}
```

## üìà –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```sql
-- –°–æ–∑–¥–∞–π—Ç–µ –∏–Ω–¥–µ–∫—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ JSON –ø–æ–ª—é
CREATE INDEX idx_leads_info_delivery_address 
ON leads USING gin ((info->>'delivery_address'));

-- –î–ª—è PostgreSQL 12+
CREATE INDEX idx_leads_info_delivery_address 
ON leads USING gin (info jsonb_path_ops);
```

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
```javascript
// –î–æ–±–∞–≤—å—Ç–µ Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
import Redis from 'ioredis';
const redis = new Redis(process.env.REDIS_URL);

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º –∫ –ë–î
const cached = await redis.get(`address:${query}`);
if (cached) {
  return NextResponse.json(JSON.parse(cached));
}
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

1. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∏–¥–∂–µ—Ç –≤ AMOCRM**
2. **–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –ø–æ–ª–µ–º –∞–¥—Ä–µ—Å–∞**
3. **–í–≤–µ–¥–∏—Ç–µ —á–∞—Å—Ç—å –∞–¥—Ä–µ—Å–∞** (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞)
4. **–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞**
5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞** –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ª–æ–≥–æ–≤

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ URL –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö AMOCRM
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–¥—Ä–µ—Å–∞
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API endpoint

---

**–í–∞–∂–Ω–æ:** –í—Å–µ URL –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑ AMOCRM. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ —É–∫–∞–∑–∞–Ω–Ω—ã–º –∞–¥—Ä–µ—Å–∞–º.
